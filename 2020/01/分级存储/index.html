<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.58.3 with theme Tranquilpeak 0.4.7-BETA">
<meta name="author" content="Kris Wu">
<meta name="keywords" content="分级存储">
<meta name="description" content="树莓派上的三种电子元件都有存储数据的功能：CPU缓存、内存和 SD卡储存。">


<meta property="og:description" content="树莓派上的三种电子元件都有存储数据的功能：CPU缓存、内存和 SD卡储存。">
<meta property="og:type" content="article">
<meta property="og:title" content="分级存储">
<meta name="twitter:title" content="分级存储">
<meta property="og:url" content="https://luciferseva.github.io/2020/01/%E5%88%86%E7%BA%A7%E5%AD%98%E5%82%A8/">
<meta property="twitter:url" content="https://luciferseva.github.io/2020/01/%E5%88%86%E7%BA%A7%E5%AD%98%E5%82%A8/">
<meta property="og:site_name" content="The way to be a master">
<meta property="og:description" content="树莓派上的三种电子元件都有存储数据的功能：CPU缓存、内存和 SD卡储存。">
<meta name="twitter:description" content="树莓派上的三种电子元件都有存储数据的功能：CPU缓存、内存和 SD卡储存。">
<meta property="og:locale" content="zh-cn">

  
    <meta property="article:published_time" content="2020-01-01T00:00:00">
  
  
    <meta property="article:modified_time" content="2020-01-01T00:00:00">
  
  
  
    
      <meta property="article:section" content="linux">
    
  
  
    
      <meta property="article:tag" content="树莓派">
    
  


<meta name="twitter:card" content="summary">







  <meta property="og:image" content="https://luciferseva.github.io/images/cover-v1.2.0.jpg">
  <meta property="twitter:image" content="https://luciferseva.github.io/images/cover-v1.2.0.jpg">


  <meta property="og:image" content="//images/cover-v1.2.0.jpg">
  <meta property="twitter:image" content="//images/cover-v1.2.0.jpg">




  <meta property="og:image" content="https://luciferseva.github.io/images/icon.png">
  <meta property="twitter:image" content="https://luciferseva.github.io/images/icon.png">


    <title>分级存储</title>

    <link rel="icon" href="images/cover.jpg">
    

    

    <link rel="canonical" href="https://luciferseva.github.io/2020/01/%E5%88%86%E7%BA%A7%E5%AD%98%E5%82%A8/">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css" integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin="anonymous" />
    
    
    <link rel="stylesheet" href="https://luciferseva.github.io/css/style-twzjdbqhmnnacqs0pwwdzcdbt8yhv8giawvjqjmyfoqnvazl0dalmnhdkvp7.min.css" />
    
    

    
      
    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="5">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://luciferseva.github.io/">The way to be a master</a>
  </div>
  
    
      <a class="header-right-picture "
         href="https://luciferseva.github.io/#POST">
    
    
    
      
        <img class="header-picture" src="https://luciferseva.github.io/images/icon.png" alt="作者的图片" />
      
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="5">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://luciferseva.github.io/#about">
          <img class="sidebar-profile-picture" src="https://luciferseva.github.io/images/icon.png" alt="作者的图片" />
        </a>
        <h4 class="sidebar-profile-name">Kris Wu</h4>
        
          <h5 class="sidebar-profile-bio">specializing in networking and communication</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://luciferseva.github.io/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">首页</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://luciferseva.github.io/categories">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">分类</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://luciferseva.github.io/tags">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">标签</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://luciferseva.github.io/archives">
    
      <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
      
      <span class="sidebar-button-desc">归档</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://luciferseva.github.io/#about">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">关于</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
  </div>
</nav>

      
  <div class="post-header-cover
              text-center
              "
       style="background-image:url('//images/cover-v1.2.0.jpg')"
       data-behavior="5">
    
      <div class="post-header main-content-wrap text-center">
  
    <h1 class="post-title" itemprop="headline">
      分级存储
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time itemprop="datePublished" datetime="2020-01-01T00:00:00Z">
        
  
  
  
  
    2020年1月1日
  

      </time>
    
    
  
  
    <span>发布在</span>
    
      <a class="category-link" href="https://luciferseva.github.io/categories/linux">linux</a>
    
  


  </div>

</div>
    
  </div>


      <div id="main" data-behavior="5"
        class="hasCover
               hasCoverMetaIn
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
          <div class="post-content markdown" itemprop="articleBody">
            <div class="main-content-wrap">
              <p>树莓派上的三种电子元件都有存储数据的功能：CPU缓存、内存和 SD卡储存。</p>

<h1 id="table-of-contents">目录</h1><nav id="TableOfContents">
<ul>
<li><a href="#分级存储">分级存储</a>
<ul>
<li><a href="#简介">简介</a>
<ul>
<li><a href="#缓存">缓存</a></li>
<li><a href="#页交换">页交换</a></li>
</ul></li>
</ul></li>
</ul>
</nav>

<h1 id="分级存储">分级存储</h1>

<h2 id="简介">简介</h2>

<p>三种元件的速度和容量各不相同。存储元件 的容量和速度是个矛盾。为了兼顾性能和成本，计算机大多采取分级存 储的形式，从而让不同速度的存储元件协同工作。分级存储的设计，兼 顾了读取速度、存储容量和计算机的稳定性。如下图所示。</p>

<table>
<thead>
<tr>
<th>类别</th>
<th>大小</th>
<th>访问速度排序</th>
<th align="center">持久</th>
</tr>
</thead>

<tbody>
<tr>
<td>cpu</td>
<td>一级缓存 32kb</td>
<td>1</td>
<td align="center">否</td>
</tr>

<tr>
<td>cpu</td>
<td>二级缓存 512kb</td>
<td>2</td>
<td align="center">否</td>
</tr>

<tr>
<td>内存</td>
<td>1g</td>
<td>3</td>
<td align="center">否</td>
</tr>

<tr>
<td>sd卡</td>
<td>4g以上</td>
<td>4</td>
<td align="center">是</td>
</tr>
</tbody>
</table>

<h3 id="缓存">缓存</h3>

<p>计算机把最快的存储元件用在最繁忙的地方。</p>

<p>CPU是树莓派执行程序的核心，我们编写的程序和需要处理的各种数据都要加载到CPU中才能执行。除了CPU频率外，CPU对数据的访问速度是决定其运行速度的一大重要因素。因此，CPU上配置了两级的高速缓存，来让CPU更快地 提取到数据。</p>

<p>由于造价昂贵，CPU缓存的容量不大。当CPU需要读写某个内存地址时，它会先检查该内存地址的数据是否已经存在于某条缓存记录（Cache Entry）中。如果缓存记录中的内存地址信息和CPU寻址信息相符，那就说明数据已经缓存了，这种情况叫作缓存命中（Cache Hit）。</p>

<p>CPU会直接读写缓存中的目标记录，速度会比读写内存快很多。如果 CPU想要读写的数据不在缓存中，就是缓存缺失（Cache Miss），那么缓存会增加一条新的缓存记录，把内存地址的数据加载到该缓存记录中。CPU随后从缓存中读写数据。出于成本的原因。我们不可能把计算机的全部数据放在CPU缓存中。缓存中无法容纳的数据，只能存放于内存和SD卡这样速度较慢的存储空间中。</p>

<p>既然这样，CPU缓存必须有一个策略，决定把哪些数据放在缓存中。为了应对缓存缺失的情况，缓存必须增加新的缓存记录。如果缓存已经没有空余的空间，则必须选择替换缓存中的一个记录。这条已经存在的缓存记录被称为牺牲者（Victim），新的缓存记录会被放在牺牲者所在的位置。 选择牺牲者的常见的方法有4种。</p>

<ol>
<li>最少使用（LFU，Least Frequently Used）的数据。</li>
<li>最久没有使用（LRU，Least Recently Used）的数据。</li>
<li>最早被缓存（FIFO，First-In First-Out）的数据。</li>
<li>随机替换（Random Replacement）。</li>
</ol>

<p>以LRU策略为例，学习缓存的替换策略。如果CPU采用了LRU策略，那么CPU为每个缓存记录增加一个计数。当CPU读缓存时，LRU会把命中记录的计数清零，而其他记录的计数增加1。如果一条记录长期 没有被读取，那么它的计数就会越来越大。在选择牺牲者时，CPU缓存 会选择计数最大的记录作为牺牲者。</p>

<p>上面对缓存工作流程的描述只是基于一层缓存的。实际上，树莓派中存在两级缓存。一级缓存L1的读写速度高于二级缓存L2，而二级缓 存L2的速度又高于内存的速度。沿用已经讨论过的工作流程，在一级缓存和二级缓存之间、二级缓存和内存之间进行数据交互。两级缓存夹在 CPU到内存之间，弥补了两者的速度差异，让计算机的数据读写变得更 有效率。 类似的缓存技术在计算机中使用很广。除了数据，CPU还会缓存来 自内存的指令及分页记录。很多技术的实现都离不开缓存带来的效率,以虚拟内存为例，虚拟内存技术可以实现很多功能，比如构建进程空间 和实现内存共享，但虚拟内存不是免费的。内核必须记录虚拟内存页和 物理内存页的对应关系，并花费额外的CPU时间进行地址转换。利用缓 存技术把分页记录放在CPU内部的高速元件上，可以有效解决寻址的效率问题。</p>

<h3 id="页交换">页交换</h3>

<p>借用缓存技术，我们弥补了CPU和内存之间的速度差。而<strong>虚拟内存技术，则可以把外部存储器空间当作内存用。其实虚拟内存诞生之初，正是为了实现这一目的</strong>。</p>

<p>长期以来，计算机运行中一直面临一个恼人的问题：进程所需的空 间有可能超过计算机的物理内存空间。这个时候计算机就无法运行对应 程序了。例如，一个内存为1GB的树莓派，它的进程数据需要占据2GB 的空间，那么树莓派就无法执行这个操作。虽然内存空间在不断增加， 但程序所需空间也越来越庞大，内存空间成了程序发展的屏障。而在计 算机上，能提供足够大存储空间的，只能是外部存储器。由于内存和外 部存储器的速度差异非常大，因此我们需要一种技术，在把外部存储器 空间变成内存空间的同时，还能一定程度上保证计算机运行的效率。
虚拟内存可以把一部分的外部存储器空间转换成内存空间，让应用 程序可以虚拟地增加内存大小。这一技术的关键在于页交换（Page Swap）。所谓的页交换，就是进程空间和外部存储空间以页为单位交 换数据。虚拟内存是一套管理数据和数据地址的方法，也可以用于外部 存储空间的管理。操作系统可以把一部分外部存储空间划分成页，称为 交换空间（Swap Space）。操作系统按照管理内存的方式来管理交换空 间。物理内存和交换空间加在一起大大拓展了实际存储容量。
当然，外部存储器读写速度慢的瓶颈始终存在。为了保证读写效 率，应用程序只用在物理内存中的虚拟内存。当程序访问的数据恰好位 于交换空间时，内核就会启动页交换，把交换空间的页转移到物理内存 中，随后内核把分页对应到该物理内存位置，并通知应用程序继续进行 数据操作。这样，程序访问的虚拟内存地址就指向了物理内存中的数据
位置。对于应用程序来说，它只是根据虚拟内存地址进行操作，整个过 程都不需要知道内核的幕后动作。
具体来说，内核记录着虚拟内存的对应关系。当应用进程访问虚拟 内存页时，内核会根据对应关系，知道物理页存在内存还是外部存储器 中。如果该页存在外部存储器，内核则会让程序短暂休息，然后将外部 存储器中这一页的内容放入物理内存中。如果内存空间已满，那么虚拟 内存要选择把内存中的一页移出交换空间，从而为要进入内存的页准备 好空间。在这个过程中，内存和外部存储器交换了一页，这也是页交换 得名的原因。移出内存的页充当了牺牲者。其实页交换和CPU的缓存替 换非常相似，选择牺牲者的方法也和缓存的替换策略一样。Linux操作 系统使用了一种类似于LRU的策略，即选择最久没有使用的分页作为牺 牲者。</p>
              
            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">标签</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://luciferseva.github.io/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/">树莓派</a>







  

                  </div>
                
              
            
            <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://luciferseva.github.io/2020/02/linux%E8%BF%90%E7%BB%B4-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E4%B8%80/" data-tooltip="linux运维 基础知识（一） ">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">下一篇</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://luciferseva.github.io/2019/12/%E6%A0%91%E8%8E%93%E6%B4%BE%E5%AD%A6%E4%B9%A0oled%E4%BD%BF%E7%94%A8/" data-tooltip="树莓派学习oled使用">
              
                  <span class="hide-xs hide-sm text-small icon-mr">上一篇</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#table-of-contents">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  
</div>

            
              
                <div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2020 Kris Wu. All Rights Reserved
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
        <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://luciferseva.github.io/2020/02/linux%E8%BF%90%E7%BB%B4-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E4%B8%80/" data-tooltip="linux运维 基础知识（一） ">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">下一篇</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://luciferseva.github.io/2019/12/%E6%A0%91%E8%8E%93%E6%B4%BE%E5%AD%A6%E4%B9%A0oled%E4%BD%BF%E7%94%A8/" data-tooltip="树莓派学习oled使用">
              
                  <span class="hide-xs hide-sm text-small icon-mr">上一篇</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#table-of-contents">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  
</div>

      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="5">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://luciferseva.github.io/images/icon.png" alt="作者的图片" />
    
    <h4 id="about-card-name">Kris Wu</h4>
    
      <div id="about-card-bio">specializing in networking and communication</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        嵌入式，物联网工程师
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        珠海
      </div>
    
  </div>
</div>

    

    
  
    
      <div id="cover" style="background-image:url('https://luciferseva.github.io/images/cover-v1.2.0.jpg');"></div>
    
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js" integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin="anonymous"></script>


<script src="https://luciferseva.github.io/js/script-pcw6v3xilnxydl1vddzazdverrnn9ctynvnxgwho987mfyqkuylcb1nlt.min.js"></script>


  
    <script src="https://luciferseva.github.io/js/clicklove.js"></script>
  

<script lang="javascript">
window.onload = updateMinWidth;
window.onresize = updateMinWidth;
document.getElementById("sidebar").addEventListener("transitionend", updateMinWidth);
function updateMinWidth() {
  var sidebar = document.getElementById("sidebar");
  var main = document.getElementById("main");
  main.style.minWidth = "";
  var w1 = getComputedStyle(main).getPropertyValue("min-width");
  var w2 = getComputedStyle(sidebar).getPropertyValue("width");
  var w3 = getComputedStyle(sidebar).getPropertyValue("left");
  main.style.minWidth = `calc(${w1} - ${w2} - ${w3})`;
}
</script>

<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>


  
    
      <script>
        var disqus_config = function () {
          this.page.url = 'https:\/\/luciferseva.github.io\/2020\/01\/%E5%88%86%E7%BA%A7%E5%AD%98%E5%82%A8\/';
          
            this.page.identifier = '\/2020\/01\/%E5%88%86%E7%BA%A7%E5%AD%98%E5%82%A8\/'
          
        };
        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'valine';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  




    
  </body>
</html>

